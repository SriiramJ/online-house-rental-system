<app-navbar></app-navbar>

<div class="properties-container">
  <!-- Header Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Find Your Perfect Home</h1>
      <p class="hero-subtitle">Discover amazing rental properties in your area</p>
    </div>
  </div>

  <div class="main-content">
    <!-- Search Section -->
    <div class="search-section">
      <div class="search-bar">
        <div class="search-input-container">
          <lucide-icon [img]="Search" class="search-icon"></lucide-icon>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            placeholder="Search properties by title or location..."
            class="search-input"
          />
          <button (click)="toggleFilters()" class="filters-btn">
            <lucide-icon [img]="Filter" class="filter-icon"></lucide-icon>
            Filters
          </button>
        </div>
      </div>

      <!-- Expandable Filters -->
      <div class="filters-container" [class.expanded]="showFilters">
        <div class="filters-grid">
          <div class="filter-group">
            <label>Min Rent</label>
            <input
              type="number"
              [(ngModel)]="minRent"
              (input)="onFilterChange()"
              placeholder="$0"
              class="filter-input"
            />
          </div>

          <div class="filter-group">
            <label>Max Rent</label>
            <input
              type="number"
              [(ngModel)]="maxRent"
              (input)="onFilterChange()"
              placeholder="$5000"
              class="filter-input"
            />
          </div>

          <div class="filter-group">
            <label>Min Bedrooms</label>
            <select
              [(ngModel)]="minBedrooms"
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option *ngFor="let option of bedroomOptions" [value]="option === 'Any' ? '' : option.replace('+', '')">
                {{ option }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>Location</label>
            <input
              type="text"
              [(ngModel)]="location"
              (input)="onFilterChange()"
              placeholder="City, State"
              class="filter-input"
            />
          </div>

          <div class="filter-group">
            <label>Property Type</label>
            <select
              [(ngModel)]="selectedType"
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option *ngFor="let type of propertyTypes" [value]="type === 'All' ? '' : type">
                {{ type }}
              </option>
            </select>
          </div>

          <div class="filter-actions">
            <button (click)="clearFilters()" class="clear-btn">
              Clear All
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count -->
    <div class="results-info">
      <span class="results-count">{{ filteredProperties.length }} properties found</span>
      <span *ngIf="totalPages > 1" class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
    </div>

    <!-- Loading State -->
    <app-loader 
      *ngIf="loading" 
      message="Loading properties..."
    ></app-loader>

    <!-- Error State -->
    <app-error-display
      *ngIf="error && !loading"
      [message]="error"
      [retrying]="retrying"
      (retry)="retry()"
    ></app-error-display>

    <!-- Properties Grid -->
    <div *ngIf="!loading && !error && paginatedProperties.length > 0" class="properties-grid">
      <div
        *ngFor="let property of paginatedProperties"
        class="property-card"
        [class.unavailable]="property.status !== 'Available'"
        (click)="viewProperty(property.id)"
      >
        <div class="property-image">
          <img [src]="property.image" [alt]="property.title" />
          <div class="availability-badge" [class.available]="property.status === 'Available'">
            {{ property.status === 'Available' ? 'Available' : 'Unavailable' }}
          </div>
        </div>

        <div class="property-content">
          <h3 class="property-title">{{ property.title }}</h3>
          <p class="property-location">
            <lucide-icon [img]="MapPin" class="location-icon"></lucide-icon>
            {{ property.location }}
          </p>

          <div class="property-details">
            <span class="detail-item">
              <lucide-icon [img]="Bed" class="detail-icon"></lucide-icon>
              {{ property.bedrooms }} bed{{ property.bedrooms !== 1 ? 's' : '' }}
            </span>
            <span class="detail-item">
              <lucide-icon [img]="Bath" class="detail-icon"></lucide-icon>
              {{ property.bathrooms }} bath{{ property.bathrooms !== 1 ? 's' : '' }}
            </span>
            <span class="detail-item">
              <lucide-icon [img]="Building" class="detail-icon"></lucide-icon>
              {{ property.property_type }}
            </span>
          </div>

          <div class="amenities" *ngIf="property.amenities && property.amenities.length">
            <div class="amenities-label">Amenities:</div>
            <div class="amenities-list">
              <span 
                *ngFor="let amenity of property.amenities.slice(0, 3)" 
                class="amenity-tag"
              >
                {{ amenity }}
              </span>
              <span *ngIf="property.amenities.length > 3" class="amenity-more">
                +{{ property.amenities.length - 3 }} more
              </span>
            </div>
          </div>

          <div class="property-footer">
            <div class="property-price">
              <lucide-icon [img]="DollarSign" class="price-icon"></lucide-icon>
              <span class="price">${{ property.rent }}</span>
              <span class="price-period">/month</span>
            </div>
            <button class="btn btn-primary btn-sm">
              <lucide-icon [img]="Eye" class="btn-icon"></lucide-icon>
              View Details
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!loading && !error && totalPages > 1" class="pagination">
      <button 
        (click)="goToPage(currentPage - 1)" 
        [disabled]="currentPage === 1"
        class="pagination-btn prev-btn"
      >
        Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()" 
          (click)="goToPage(page)"
          [class.active]="page === currentPage"
          class="page-btn"
        >
          {{ page }}
        </button>
      </div>
      
      <button 
        (click)="goToPage(currentPage + 1)" 
        [disabled]="currentPage === totalPages"
        class="pagination-btn next-btn"
      >
        Next
      </button>
    </div>

    <!-- Empty State -->
    <app-empty-state
      *ngIf="!loading && !error && filteredProperties.length === 0"
      title="No properties found"
      message="Try adjusting your search criteria or clearing filters to see more results."
      actionText="Clear Filters"
      (action)="clearFilters()"
    ></app-empty-state>
  </div>
</div>

<app-footer></app-footer>